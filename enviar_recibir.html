<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enviar y Recibir</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <div class="logo-container">
            <img src="logo.jpeg" alt="Logo" class="logo">
            <h1 class="title">WalletBridge</h1>
        </div>
        <nav class="toolbar">
            <button class="toolbar-button" onclick="location.href='inicio.html'">Inicio</button>
            <button class="toolbar-button active">Enviar y Recibir</button>
            <button class="toolbar-button" onclick="location.href='pagos_qr.html'">Pagos QR</button>
            <button class="toolbar-button" onclick="location.href='historial.html'">Historial</button>
        </nav>
    </div>

    <div class="welcome-section" style="text-align: center;">
        <div class="welcome-text">
            <h1>Enviar y Recibir</h1>
            <p>Gestiona tus transferencias de manera rápida y segura.</p>
        </div>
        <div class="welcome-image">
            <img src="trans.jpg" alt="Enviar y Recibir" class="image">
        </div>
    </div>

    <div class="content">
        <div class="action-section">
            <div class="action-card">
                <h2>Enviar</h2>
                <label for="destination-pointer">Payment Pointer de Destino</label>
                <input type="text" id="destination-pointer" class="textfield" placeholder="Ejemplo: $wallet.example.com">
                <span id="destination-pointer-error" class="error-message"></span>

                <label for="send-amount">Monto</label>
                <input type="text" id="send-amount" class="textfield" placeholder="Ejemplo: 100">
                <span id="send-amount-error" class="error-message"></span>

                <label for="source-pointer">Wallet de Origen</label>
                <input type="text" id="source-pointer" class="textfield" placeholder="Ejemplo: $wallet.origen.com">
                <span id="source-pointer-error" class="error-message"></span>

                <button class="action-button" onclick="if (validateFields([{id: 'destination-pointer'}, {id: 'send-amount'}, {id: 'source-pointer'}])) sendPayment();">Realizar Pago</button>
                <div id="send-message-area" class="message-area"></div>
            </div>
            <div class="action-card">
                <h2>Recibir</h2>
                <label for="payment-pointer">Payment Pointer</label>
                <input type="text" id="payment-pointer" class="textfield" placeholder="Ejemplo: $wallet.example.com">
                <label for="amount">Monto</label>
                <input type="text" id="amount" class="textfield" placeholder="Ejemplo: 100">
                <button class="action-button" onclick="generateReceiveQR()">Generar QR para recibir</button>
                <div id="receive-qr-container" class="qr-container"></div>
            </div>
            <div class="action-card">
                <h2>Consultar Pago</h2>
                <label for="payment-id">ID del Pago</label>
                <input type="text" id="payment-id" class="textfield" placeholder="Ejemplo: 12345">
                <button class="action-button" onclick="consultPayment()">Consultar</button>
                <div id="payment-details" class="message-area"></div>
            </div>
        </div>
        <div class="message-area" id="message-area">
            <!-- Message will appear here -->
        </div>
        <div class="info-section">
            <h3>Información sobre Enviar y Recibir</h3>
            <p>Con nuestra plataforma, puedes enviar y recibir dinero de manera rápida y segura. Explora las opciones y disfruta de una experiencia única.</p>
        </div>
    </div>

    <div class="footer">
        <p>Hackathon 2025</p>
    </div>

    <script>
        function showMessage(action) {
            const messageArea = document.getElementById('message-area');
            messageArea.innerText = `Has ${action} con éxito!`;
            setTimeout(() => {
                messageArea.innerText = '';
            }, 3000);
        }

        function generateReceiveQR() {
            const paymentPointer = document.getElementById('payment-pointer').value;
            const amount = document.getElementById('amount').value;
            const qrContainer = document.getElementById('receive-qr-container');

            // Aquí iría la lógica para generar el QR code
            // Por ahora, solo mostramos un mensaje
            qrContainer.innerHTML = `<p>QR Code generado para recibir ${amount} a ${paymentPointer}</p>`;
        }

        async function sendPayment() {
            const sourcePointer = document.getElementById('source-pointer').value;
            const destinationPointer = document.getElementById('destination-pointer').value;
            const sendAmount = document.getElementById('send-amount').value;
            const sendMessageArea = document.getElementById('send-message-area');

            try {
                const response = await fetch('http://localhost:3000/api/outgoing-payments', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ sourcePointer, paymentPointer: destinationPointer, amount: sendAmount }),
                });

                const data = await response.json();
                if (response.ok) {
                    sendMessageArea.innerText = `Pago de ${sendAmount} enviado desde ${sourcePointer} a ${destinationPointer}`;
                } else {
                    sendMessageArea.innerText = `Error: ${data.message}`;
                }
            } catch (error) {
                sendMessageArea.innerText = `Error al enviar el pago: ${error.message}`;
            }

            setTimeout(() => {
                sendMessageArea.innerText = '';
            }, 3000);
        }

        async function consultPayment() {
            const paymentId = document.getElementById('payment-id').value;
            const paymentDetails = document.getElementById('payment-details');

            try {
                const response = await fetch(`http://localhost:3000/api/outgoing-payments/${paymentId}`);
                const data = await response.json();

                if (response.ok) {
                    paymentDetails.innerText = `Detalles del pago con ID ${paymentId}: Monto - ${data.amount}, Estado - ${data.status}`;
                } else {
                    paymentDetails.innerText = `Error: ${data.message}`;
                }
            } catch (error) {
                paymentDetails.innerText = `Error al consultar el pago: ${error.message}`;
            }

            setTimeout(() => {
                paymentDetails.innerText = '';
            }, 5000);
        }

        function validateFields(fields) {
            let isValid = true;
            fields.forEach(field => {
                const input = document.getElementById(field.id);
                const errorMessage = document.getElementById(`${field.id}-error`);
                if (!input.value) {
                    isValid = false;
                    errorMessage.innerText = 'Este campo es obligatorio';
                } else {
                    errorMessage.innerText = '';
                }
            });
            return isValid;
        }
    </script>
</body>
</html>